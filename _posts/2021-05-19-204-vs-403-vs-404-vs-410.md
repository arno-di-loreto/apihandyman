---
title: "Move along, no resource to see here (truly), HTTP status code 204 vs 403 vs 404 vs 410"
series: Choosing HTTP status codes
series_number: 3
date: 2021-05-19
author: Arnaud Lauret
layout: post
alias: no-resource-to-see-here
category: post
permalink: /move-along-no-resource-to-see-here-seriously-http-status-code-204-vs-403-vs-404-vs-410/
tags:
    - HTTP Status Codes
tools:
    - Web Concepts
---

{% include _postincludes/choosing-http-status-codes.md style="intro" %} This third post answers the following question: given that resource with id 123 actually doesn't exist in the underlying database, what should be the response to `GET /resources/123` when consumer is allowed to access such ressource? {% include http-status-code.html code="204" %}, {% include http-status-code.html code="403" %}, {% include http-status-code.html code="404" %} or {% include http-status-code.html code="410" %}?

<!--more-->

{%- include _postincludes/choosing-http-status-codes.md -%}

# The context

Let's say your are creating an API for a library, obviously you'll design a `GET /books` to search for books and a `GET /books/{isbn}` to get detailed information about a book.
You did use an [International Standard Book Number](https://en.wikipedia.org/wiki/International_Standard_Book_Number) because such a unique and universally known id is far more convenient than an opaque `bookId` generated by your implementation.
Indeed using standard/well known values for resource identifiers makes an API more interoperable and usable in other contexts than yours.
Design digression is over, let's get back to the true topic of this post: choosing an HTTP status code.

A library may not own all books that have been published on earth , end users may also simply mistype an ISBN or books may have been removed from the library.
What should be the response to a `GET /books/{not known, totally wrong or not present anymore ISBN}`?

{% include image.html source="twitter-poll.png" alt="Twitter poll results" %}

According to my (vague) Twitter poll (which was not explicitly talking about the removed use case), 94% of respondents would return a {% include http-status-code.html code="404" %}, while 4% would return a {% include http-status-code.html code="403" %} and 2% would return a {% include http-status-code.html code="410" %}.
Note also that, in the discussion, some people mentioned returning a {% include http-status-code.html code="204" %}.
Let's see what could be the correct answer(s) according to RFCs.

# No brainer, use 404

{% include http-status-code.html code="404" style="quote" %}

Let's start with what is the most common and valid response in such a case: {% include http-status-code.html code="404" style="code" %}
This HTTP status code reason {% include http-status-code.html code="404" style="reason" %} is both obvious and actually means what everybody thinks it means ([which is not always the case](/hands-off-that-resource-http-status-code-401-vs-403-vs-404/#never-ever-use-401-dont-be-fooled-by-its-reason)).

In our case a `GET /books/{totally wrong ISBN}` must return a {% include http-status-code.html code="404" style="code" %}
And that must be your favorite response when consumer is requesting something that doesn't exist, not only because {% include http-status-code.html code="404" style="rfc" %} says so, but also because people are used to get that response in such a case.
Being consistent with the rest of the world is a rule of thumb when building APIs (or whatever).

Though people are used to it, there can be some subtleties that requires a more specific HTTP status code when signifying "that doesn't exist".

# Has existed and can do something about it, you may use 410

{% include http-status-code.html code="410" style="quote" %}

In our case a `GET /books/{"book that once has been in library but is no more" ISBN}` could return such a status code, especially if the end user is a librarian who deleted a book by mistake.

Digression: A regular library user may get a {% include http-status-code.html code="404" %} for the same request.
That means that your API may return different responses depending on who is the consumer/end/user.

Your database state is not your API data state, the data returned by an API may not be exactly how they actually are in the underlying database (we already have seen that in [previous post](/hands-off-that-resource-http-status-code-401-vs-403-vs-404/)).
It's not unusual to use a soft delete when removing something from a database and so simply flag it as "deleted" but keeping the data.
There are many reasons to do that, regulations like [GDPR](https://en.wikipedia.org/wiki/General_Data_Protection_Regulation) may force you to do so (though you should move such data in another database) or you may want to propose an "undo" possibility.

A {% include http-status-code.html code="410" style="code" %} could also be a good response to a request made on an expired temporary URL (that was valid only for a short period of time, that reminds me to write a post about signed URLs).

Whatever the reason of signifying that something actually existed, you may return a {% include http-status-code.html code="410" %} if and only if consumers can do something about it (like undoing something or requesting a new temporary URL). 
But in that case you should provide information about what they can do about it and how (in response body or at least in documentation).

# No scopes, rights or privilege involved, don't use 403

{% include http-status-code.html code="403" style="quote" %}

In our library use case there are no scopes/privileges/rights involved, a `GET /books/{wrong ISBN}` will never ever return a {% include http-status-code.html code="403" %} but a {% include http-status-code.html code="404" %}.

A `GET /books/{has existed ISBN}` may return a {% include http-status-code.html code="410" %} as seen in previous section.
It's only after that, when trying to undelete the book, maybe with a `PUT /books/{"book that once has been in library but is no more" ISBN}`, that the response could be a {% include http-status-code.html code="403" %} if librarian is not allowed to to so.

If privileges/rights are involved when accessing resources (either `WHATEVER /books/{isbn}` in general or a specific `WHATEVER /books/{specific isbn}`), a {% include http-status-code.html code="403" style="code" %} may be returned, you should read {% include post-link.html alias="hands-off-that-resource" %} to learn more about that.

# It's a consumer error, don't use 204

{% include http-status-code.html code="204" style="quote" %}

Obviously, I didn't include {% include http-status-code.html code="204" %} in the poll because Twitter only allows 3 choices ... 
Well to be honest, though I often meet people wanting to use it that way, I totally forget it for that poll ðŸ˜… (and would probably had propose it instead of {% include http-status-code.html code="403" %}).


The {% include http-status-code.html code="204" style="reason"%} reason may fool you, but the description is quite clear, it doesn't mean "there's nothing for this path" but "these is something for this path but not content to return".
Also that HTTP status is a {% include http-status-code.html code="2xx" %}, it is not intended to signify that something went wrong which is the case here, consumer did send a non existing/wrong resource id.
So you should avoid using it in such a case.


