I"4+<p>When designing APIs, choosing HTTP status codes is not always that obvious and prone to errors, I hope this post series will help you to avoid common mistakes and choose an adapted one according to the context. This third post answers the following question: given that resource with id 123 actually doesn’t exist in the underlying database, what should be the response to <code>GET /resources/123</code> when consumer is allowed to access such ressource? <code>204 No Content</code>, <code>403 Forbidden</code>, <code>404 Not Found</code> or <code>410 Gone</code>?</p>

<!--more-->
<div class="card series-toc">
  <div class="card-header series-toc-title">
    <h5 id="series">Choosing HTTP status codes Series</h5>
  </div>
  <div class="row series-toc_content">
    <div class="col-md-7 series-toc-summary">
      <div class="card-body">
        <p class="card-text">When designing APIs, choosing HTTP status codes is not always that obvious and prone to errors, I hope this post series will help you to avoid common mistakes and choose an adapted one according to the context.<div class="alert alert-info">
I never remember in which RFCs HTTP status codes are defined.
To get a quick access to their documentation, I use <a class="alert-link" href="https://webconcepts.info/concepts/http-status-code/">Erik Wilde's Web Concepts</a>.
</div>Very special thanks to all Twitter people participating to the <a href="https://twitter.com/search?q=%23choosehttpstatuscode&amp;src=typed_query">#choosehttpstatuscode</a> polls and discussions</p>
      </div>
    </div>
    <div class="col-md-5 series-toc-list">
      
      <ul class="list-group list-group-flush">
        
          
          <li class="list-group-item"><a href="/this-is-not-the-http-method-you-re-looking-for-http-status-code-404-vs-405-vs-501/">1 - This is not the HTTP method you're looking for, HTTP status code 404 vs 405 vs 501</a></li>
          
        
          
          <li class="list-group-item"><a href="/hands-off-that-resource-http-status-code-401-vs-403-vs-404/">2 - Hands off that resource, HTTP status code 401 vs 403 vs 404</a></li>
          
        
          
          <li class="list-group-item active">3 - Move along, no resource to see here (truly), HTTP status code 204 vs 403 vs 404 vs 410</li>
          
        
          
          <li class="list-group-item"><a href="/empty-lists-http-status-code-200-vs-204-vs-404/">4 - Empty list, HTTP status code 200 vs 204 vs 404</a></li>
          
        
        
      </ul>
    </div>
  </div>
</div>
<h1 id="the-context">The context</h1>

<p>Let’s say your are creating an API for a library, obviously you’ll design a <code>GET /books</code> to search for books and a <code>GET /books/{isbn}</code> to get detailed information about a book.
You did use an <a href="https://en.wikipedia.org/wiki/International_Standard_Book_Number">International Standard Book Number</a> because such a unique and universally known id is far more convenient than an opaque <code>bookId</code> generated by your implementation.
Indeed using standard/well known values for resource identifiers makes an API more interoperable and usable in other contexts than yours.
Design digression is over, let’s get back to the true topic of this post: choosing an HTTP status code.</p>

<p>A library may not own all books that have been published on earth , end users may also simply mistype an ISBN or books may have been removed from the library.
What should be the response to a <code>GET /books/{not known, totally wrong or not present anymore ISBN}</code>?</p>

<div class="image ">
    <figure class="figure">
        <img src="/images/move-along-no-resource-to-see-here-seriously-http-status-code-204-vs-403-vs-404-vs-410/twitter-poll.png" class="figure-img img-fluid" alt="Twitter poll results" /></figure>
</div>

<p>According to my (vague) Twitter poll (which was not explicitly talking about the removed use case), 94% of respondents would return a <code>404 Not Found</code>, while 4% would return a <code>403 Forbidden</code> and 2% would return a <code>410 Gone</code>.
Note also that, in the discussion, some people mentioned returning a <code>204 No Content</code>.
Let’s see what could be the correct answer(s) according to RFCs.</p>

<h1 id="no-brainer-use-404">No brainer, use 404</h1>

<blockquote class="blockquote">
    <p class="mb-0">The 404 (Not Found) status code indicates that the origin server did not find a current representation for the target resource or is not willing to disclose that one exists.</p><footer class="blockquote-footer">
        <cite title="Source Title"><a href="http://tools.ietf.org/html/rfc7231#section-6.5.4">RFC 7231 Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content, section 6.5.4</a></cite>
    </footer></blockquote>

<p>Let’s start with what is the most common and valid response in such a case: <code>404</code>
This HTTP status code reason <code>Not Found</code> is both obvious and actually means what everybody thinks it means (<a href="/hands-off-that-resource-http-status-code-401-vs-403-vs-404/#never-ever-use-401-dont-be-fooled-by-its-reason">which is not always the case</a>).</p>

<p>In our case a <code>GET /books/{totally wrong ISBN}</code> must return a <code>404</code>
And that must be your favorite response when consumer is requesting something that doesn’t exist, not only because RFC 7231 says so, but also because people are used to get that response in such a case.
Being consistent with the rest of the world is a rule of thumb when building APIs (or whatever).</p>

<p>Though people are used to it, there can be some subtleties that requires a more specific HTTP status code when signifying “that doesn’t exist”.</p>

<h1 id="has-existed-and-can-do-something-about-it-you-may-use-410">Has existed and can do something about it, you may use 410</h1>

<blockquote class="blockquote">
    <p class="mb-0">The 410 (Gone) status code indicates that access to the target resource is no longer available at the origin server and that this condition is likely to be permanent.</p><footer class="blockquote-footer">
        <cite title="Source Title"><a href="http://tools.ietf.org/html/rfc7231#section-6.5.9">RFC 7231 Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content, section 6.5.9</a></cite>
    </footer></blockquote>

<p>In our case a <code>GET /books/{"book that once has been in library but is no more" ISBN}</code> could return such a status code, especially if the end user is a librarian who deleted a book by mistake.</p>

<p>Digression: A regular library user may get a <code>404 Not Found</code> for the same request.
That means that your API may return different responses depending on who is the consumer/end/user.</p>

<p>Your database state is not your API data state, the data returned by an API may not be exactly how they actually are in the underlying database (we already have seen that in <a href="/hands-off-that-resource-http-status-code-401-vs-403-vs-404/">previous post</a>).
It’s not unusual to use a soft delete when removing something from a database and so simply flag it as “deleted” but keeping the data.
There are many reasons to do that, regulations like <a href="https://en.wikipedia.org/wiki/General_Data_Protection_Regulation">GDPR</a> may force you to do so (though you should move such data in another database) or you may want to propose an “undo” possibility.</p>

<p>A <code>410</code> could also be a good response to a request made on an expired temporary URL (that was valid only for a short period of time, that reminds me to write a post about signed URLs).</p>

<p>Whatever the reason of signifying that something actually existed, you may return a <code>410 Gone</code> if and only if consumers can do something about it (like undoing something or requesting a new temporary URL). 
But in that case you should provide information about what they can do about it and how (in response body or at least in documentation).</p>

<h1 id="no-scopes-rights-or-privilege-involved-dont-use-403">No scopes, rights or privilege involved, don’t use 403</h1>

<blockquote class="blockquote">
    <p class="mb-0">The 403 (Forbidden) status code indicates that the server understood the request but refuses to authorize it.  A server that wishes to make public why the request has been forbidden can describe that reason in the response payload (if any).</p><footer class="blockquote-footer">
        <cite title="Source Title"><a href="https://tools.ietf.org/html/rfc7231#section-6.5.3">RFC 7231 Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content, section 6.5.3</a></cite>
    </footer></blockquote>

<p>In our library use case there are no scopes/privileges/rights involved, a <code>GET /books/{wrong ISBN}</code> will never ever return a <code>403 Forbidden</code> but a <code>404 Not Found</code>.</p>

<p>A <code>GET /books/{has existed ISBN}</code> may return a <code>410 Gone</code> as seen in previous section.
It’s only after that, when trying to undelete the book, maybe with a <code>PUT /books/{"book that once has been in library but is no more" ISBN}</code>, that the response could be a <code>403 Forbidden</code> if librarian is not allowed to to so.</p>

<p>If privileges/rights are involved when accessing resources (either <code>WHATEVER /books/{isbn}</code> in general or a specific <code>WHATEVER /books/{specific isbn}</code>), a <code>403</code> may be returned, you should read <a class="post-link" href="/hands-off-that-resource-http-status-code-401-vs-403-vs-404/">Choosing HTTP status codes Part 2 - Hands off that resource, HTTP status code 401 vs 403 vs 404</a> to learn more about that.</p>

<h1 id="its-a-consumer-error-dont-use-204">It’s a consumer error, don’t use 204</h1>

<blockquote class="blockquote">
    <p class="mb-0">The 204 (No Content) status code indicates that the server has successfully fulfilled the request and that there is no additional content to send in the response payload body.</p><footer class="blockquote-footer">
        <cite title="Source Title"><a href="http://tools.ietf.org/html/rfc7231#section-6.3.5">RFC 7231 Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content, section 6.3.5</a></cite>
    </footer></blockquote>

<p>Obviously, I didn’t include <code>204 No Content</code> in the poll because Twitter only allows 3 choices … 
Well to be honest, though I often meet people wanting to use it that way, I totally forget it for that poll 😅 (and would probably had propose it instead of <code>403 Forbidden</code>).</p>

<p>The <code>No Content</code> reason may fool you, but the description is quite clear, it doesn’t mean “there’s nothing for this path” but “these is something for this path but not content to return”.
Also that HTTP status is a <code>2xx Success class</code>, it is not intended to signify that something went wrong which is the case here, consumer did send a non existing/wrong resource id.
So you should avoid using it in such a case.</p>

:ET